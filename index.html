<!-- USER_APP.HTML -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PEPE PARODY</title>
  <!-- Tailwind, Firebase, and Styles -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js"></script>
  <style>
    .glass{backdrop-filter: blur(10px)} .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.6rem 1rem;border-radius:1rem; cursor: pointer;} .tab-active{background:rgba(255,255,255,.12)} .hide{display:none} input:focus { border-color: #22c55e; outline: none; }
  </style>
</head>
<body class="min-h-dvh text-white bg-gradient-to-b from-[#0b1220] to-[#0e1624]">
<div class="relative mx-auto max-w-3xl p-4 sm:p-6 pb-24 space-y-4">

    <!-- LOGIN/SIGNUP SCREEN -->
    <section data-screen="login" class="space-y-4">
      <div class="glass rounded-3xl border border-white/10 p-5 bg-card shadow-soft text-center">
        <h2 class="text-2xl font-bold mb-4">Welcome to PEPE PARODY</h2>
        <div class="space-y-3">
          <input id="loginEmail" type="email" placeholder="Enter your email" class="w-full rounded-xl px-3 py-2 bg-white/10 border border-white/10 text-white">
          <input id="loginPassword" type="password" placeholder="Enter your password" class="w-full rounded-xl px-3 py-2 bg-white/10 border border-white/10 text-white">
        </div>
        <div class="flex gap-3 mt-4">
          <button id="loginBtn" class="btn flex-1 bg-acc text-black font-semibold">Login</button>
          <button id="signupBtn" class="btn flex-1 bg-acc2 text-black font-semibold">Sign Up</button>
        </div>
        <p id="authHint" class="text-xs text-orange-400 mt-3 h-4"></p>
      </div>
    </section>

    <!-- MAIN APP SCREENS (Profile, Tasks, Wallet) -->
    <main id="mainApp" class="hide space-y-4">
      <!-- Top Bar with Logout -->
      <header class="flex items-center justify-between glass rounded-b-2xl border-b border-white/10 p-4 shadow-lg">
        <div class="flex items-center gap-3">
            <div class="h-11 w-11 rounded-2xl bg-acc grid place-items-center text-black font-extrabold shadow-soft overflow-hidden"><img src="https://www.svgrepo.com/show/473727/pepe-coin.svg" alt="PEPE Coin" class="h-full w-full object-cover"></div>
            <div><h1 class="text-2xl font-bold tracking-tight">PEPE PARODY</h1><p class="text-xs text-white/70" id="userEmailDisplay"></p></div>
        </div>
        <button id="logoutBtn" class="btn bg-white/10 text-xs">Logout</button>
      </header>

      <!-- Profile Screen -->
      <section data-screen="profile" class="space-y-4">
        <div class="glass rounded-3xl border border-white/10 p-5 bg-card shadow-soft">
          <h3 class="font-semibold mb-2">Profile Details</h3>
          <div class="mt-2 grid sm:grid-cols-2 gap-3">
            <div class="rounded-2xl bg-white/5 p-4 text-sm"><div class="opacity-70">Name</div><div id="pfName" class="text-lg font-semibold">User</div></div>
            <div class="rounded-2xl bg-white/5 p-4 text-sm"><div class="opacity-70">User ID</div><div id="pfId" class="text-lg font-semibold break-all">–</div></div>
            <div class="rounded-2xl bg-white/5 p-4 text-sm"><div class="opacity-70">Referred By</div><div id="pfReferredBy" class="text-lg font-semibold">–</div></div>
            <div class="rounded-2xl bg-white/5 p-4 text-sm"><div class="opacity-70">Total Referrals</div><div id="pfRefCount" class="text-lg font-semibold">0</div></div>
          </div>
        </div>
        <!-- Other sections like Tasks and Wallet need to be added here -->
      </section>
    </main>

    <!-- Bottom Nav -->
    <nav id="navBar" class="fixed bottom-0 inset-x-0 mx-auto max-w-3xl bg-white/5 backdrop-blur border-t border-white/10 p-2 rounded-t-2xl shadow-lg hide">
      <div id="navGrid" class="grid grid-cols-3 gap-2">
        <button data-nav="profile" class="btn tab-active font-semibold">Profile</button>
        <button data-nav="tasks" class="btn font-semibold">Tasks</button>
        <button data-nav="wallet" class="btn font-semibold">Wallet</button>
      </div>
    </nav>
</div>

<script type="module">
  // --- Firebase Imports ---
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

  // --- Config ---
  const firebaseConfig = {
    apiKey: "AIzaSyBAXVxTPaiP8uFoQH5jEG2oUovvrrXbJDo",
    authDomain: "pepe-earning-app.firebaseapp.com",
    projectId: "pepe-earning-app",
    storageBucket: "pepe-earning-app.firebasestorage.app",
    messagingSenderId: "307051092104",
    appId: "1:307051092104:web:0649d26ebe30d61e63e73d"
  };

  // --- Initialize Firebase ---
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // --- Element Selectors ---
  const loginScreen = document.querySelector('[data-screen="login"]');
  const mainApp = document.getElementById('mainApp');
  const navBar = document.getElementById('navBar');
  const loginEmailEl = document.getElementById('loginEmail');
  const loginPasswordEl = document.getElementById('loginPassword');
  const loginBtn = document.getElementById('loginBtn');
  const signupBtn = document.getElementById('signupBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const authHint = document.getElementById('authHint');
  const pfNameEl = document.getElementById('pfName');
  const pfIdEl = document.getElementById('pfId');
  const userEmailDisplayEl = document.getElementById('userEmailDisplay');

  // --- Auth State Management ---
  onAuthStateChanged(auth, user => {
    if (user) {
      // User is logged in
      loginScreen.classList.add('hide');
      mainApp.classList.remove('hide');
      navBar.classList.remove('hide');
      
      userEmailDisplayEl.textContent = user.email;
      pfIdEl.textContent = user.uid;
      
      // Listen for real-time updates to user data
      const userRef = doc(db, "users", user.uid);
      onSnapshot(userRef, (doc) => {
        if (doc.exists()) {
          const data = doc.data();
          pfNameEl.textContent = data.name || 'User';
          // Update other UI elements (balance, referrals, etc.) here
          // Example:
          // document.getElementById('walletBalance').textContent = data.balance || 0;
        }
      });

    } else {
      // User is logged out
      loginScreen.classList.remove('hide');
      mainApp.classList.add('hide');
      navBar.classList.add('hide');
    }
  });

  // --- Event Listeners ---
  signupBtn.addEventListener('click', async () => {
    const email = loginEmailEl.value;
    const password = loginPasswordEl.value;
    authHint.textContent = 'Signing up...';
    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;
      
      // Create a new document for the user in Firestore
      const userRef = doc(db, "users", user.uid);
      await setDoc(userRef, {
        name: email.split('@')[0], // Default name
        email: user.email,
        balance: 0,
        referrals: 0,
        tasksCompleted: [],
        createdAt: serverTimestamp()
      });
      authHint.textContent = 'Signup successful! You are now logged in.';
    } catch (error) {
      authHint.textContent = error.message;
    }
  });

  loginBtn.addEventListener('click', async () => {
    const email = loginEmailEl.value;
    const password = loginPasswordEl.value;
    authHint.textContent = 'Logging in...';
    try {
      await signInWithEmailAndPassword(auth, email, password);
      authHint.textContent = '';
    } catch (error) {
      authHint.textContent = error.message;
    }
  });

  logoutBtn.addEventListener('click', async () => {
    await signOut(auth);
  });
</script>
</body>
</html>
